// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("CLASSES_DATABASE_URL")
}

enum FileType {
  document
  image
  video
  audio
  other
}

model Class {
  class_id    Int               @id @default(autoincrement())
  class_name  String            @db.VarChar
  class_code  String            @unique @db.VarChar
  description String?           @db.Text
  teacher_id  Int
  created_at  DateTime          @default(now()) @db.Timestamp(6)
  
  posts       Post[]
  enrollments ClassEnrollment[]
  teachers    ClassTeacher[]

  @@map("classes")
}

model Post {
  id         Int        @id @default(autoincrement())
  class_id   Int
  parent_id  Int?
  message    String?    @db.VarChar
  sender_id  Int
  created_at DateTime   @default(now()) @db.Timestamp(6)
  
  class     Class      @relation(fields: [class_id], references: [class_id], onDelete: Cascade)
  materials Material[]

  @@map("posts")
}

model Material {
  material_id Int      @id @default(autoincrement())
  post_id     Int
  title       String   @db.VarChar
  file_url    String   @db.VarChar
  uploaded_by Int
  uploaded_at DateTime @default(now()) @db.Timestamp(6)
  type        FileType @default(other)
  file_size   Int?
  
  post Post @relation(fields: [post_id], references: [id], onDelete: Cascade)

  @@map("materials")
}

model ClassEnrollment {
  enrollment_id Int       @id @default(autoincrement())
  class_id      Int
  student_id    Int
  enrolled_at   DateTime  @default(now()) @db.Timestamp(6)
  deleted_at    DateTime? @db.Timestamp(6)
  
  class Class @relation(fields: [class_id], references: [class_id], onDelete: Cascade)

  @@unique([class_id, student_id])
  @@map("class_enrollments")
}

model ClassTeacher {
  class_id   Int
  teacher_id Int
  created_at DateTime @default(now()) @db.Timestamp(6)
  
  class Class @relation(fields: [class_id], references: [class_id], onDelete: Cascade)

  @@id([class_id, teacher_id])
  @@map("class_teacher")
}